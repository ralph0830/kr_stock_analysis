# HMR(í•« ë¦¬ë¡œë“œ) ê°œë°œ í™˜ê²½ ì„¤ì • ê°€ì´ë“œ

## ë¬¸ì œ ìƒí™©

Docker ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ Next.js dev ì„œë²„ë¥¼ ì‹¤í–‰í•  ê²½ìš°:
- âœ… í˜ì´ì§€ ë¡œë“œ ì •ìƒ
- âŒ HMR(í•« ë¦¬ë¡œë“œ) WebSocket ì—°ê²° ì‹¤íŒ¨
- âŒ ì½”ë“œ ìˆ˜ì • ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ ì•ˆë¨

## ğŸ¯ ì¶”ì²œ ë°©ë²•

### ë°©ë²• 1: ë¡œì»¬ ê°œë°œ + Docker ë°±ì—”ë“œ (â­ ì¶”ì²œ)

**êµ¬ì¡°:** í”„ë¡ íŠ¸ì—”ë“œëŠ” ë¡œì»¬, ë°±ì—”ë“œëŠ” Docker

```bash
# Terminal 1: ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (Docker)
docker compose --profile dev up -d

# Terminal 2: í”„ë¡ íŠ¸ì—”ë“œ (ë¡œì»¬)
cd frontend
npm run dev  # http://localhost:5110
```

**ì¥ì :**
- HMR ì™„ë²½ ì‘ë™, ê°€ì¥ ë¹ ë¦„
- IDE ê¸°ëŠ¥ full ì‚¬ìš© (debugger, IntelliSense ë“±)
- ë°±ì—”ë“œëŠ” Docker í™˜ê²½ ê·¸ëŒ€ë¡œ

**ë‹¨ì :**
- node.js ì„¤ì¹˜ í•„ìš” (ì´ë¯¸ ìˆìŒ)
- í„°ë¯¸ë„ 2ê°œ í•„ìš”

---

### ë°©ë²• 2: VS Code Devcontainer (â­â­ IDE í†µí•©)

**ì„¤ì •:** `.devcontainer/devcontainer.json` ìƒì„±ë¨

**ì‚¬ìš©ë²•:**
1. VS Codeì—ì„œ `frontend` í´ë” ì—´ê¸°
2. F1 â†’ "Dev Containers: Reopen in Container"
3. ìë™ìœ¼ë¡œ ì»¨í…Œì´ë„ˆ ì—°ê²°, HMR ì‘ë™

**ì¥ì :**
- IDE ë‚´ì—ì„œ ê°œë°œ (ì™„ì „í•œ í†µí•©)
- í™˜ê²½ ì„¤ì • ê³µìœ 
- íŒ€ì›ë³„ ë™ì¼í•œ ê°œë°œ í™˜ê²½

**ë‹¨ì :**
- Devcontainer ì„¤ì¹˜ í•„ìš”
- ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ë§ì´ ì‚¬ìš©

---

### ë°©ë²• 3: Host ë„¤íŠ¸ì›Œí¬ ëª¨ë“œ

**ì„¤ì •:** `docker-compose.dev.yml`ì—ì„œ `network_mode: host`

```yaml
# docker-compose.dev.yml
services:
  frontend:
    network_mode: host  # ì „ì²´ ì„¤ì • ì ìš© í•„ìš”
    ports: []  # ports ì œê±° í•„ìš”
```

**ì£¼ì˜:**
- í¬íŠ¸ ì¶©ëŒ í™•ì¸ í•„ìš”
- ë³´ì•ˆ: ì»¨í…Œì´ë„ˆê°€ í˜¸ìŠ¤íŠ¸ì™€ ê°™ì€ ë„¤íŠ¸ì›Œí¬

---

### ë°©ë²• 4: ì™¸ë¶€ Node + ë³¼ë¥¨ ë§ˆìš´íŠ¸

**êµ¬ì¡°:** í˜¸ìŠ¤íŠ¸ì˜ nodeë¥¼ ì‚¬ìš©í•´ì„œ ì»¨í…Œì´ë„ˆ ì—°ê²°

```yaml
# docker-compose.dev.yml
services:
  frontend:
    build:
      target: development
    volumes:
      - /home/ralph/work/python/kr_stock_analysis/frontend:/app:rw  # ì½ê¸°/ì“°ê¸°
      - node_modules:/app/node_modules  # í˜¸ìŠ¤íŠ¸ node_modules ë³¼ë¥¨
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:5111
    # í˜¸ìŠ¤íŠ¸ node_modulesê°€ ìš°ì„ ìˆœìœ„
    command: ["node", "/app/node_modules/.bin/next", "dev", "-p", "5110"]
```

**ì¥ì :**
- í˜¸ìŠ¤íŠ¸ node ì‚¬ìš© (ë¹ ë¦„)
- Docker ì´ë¯¸ì§€ëŠ” ì˜ì¡´ì„± ë¹Œë“œìš©ìœ¼ë¡œë§Œ ì‚¬ìš©

**ë‹¨ì :**
- í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆ node ë²„ì „ ë¶ˆì¼ì¹˜ ìœ„í—˜

---

### ë°©ë²• 5: Turbopack ì‚¬ìš© (Next.js 15+)

**package.json ìˆ˜ì •:**

```json
{
  "scripts": {
    "dev": "next dev --turbo"
  }
}
```

**ì¥ì :**
- ê¸°ì¡´ HMRë³´ë‹¤ ë¹ ë¦„
- ì•ˆì •ì 
- Docker í™˜ê²½ì—ì„œë„ ì˜ ì‘ë™

---

## ğŸ“‹ ì¶”ì²œ ì›Œí¬í”Œë¡œìš°

### ì¼ì¼ ê°œë°œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë¡œì»¬ Frontend  â”‚ â†â†’ â”‚  Docker Backend   â”‚
â”‚  (npm run dev)  â”‚    â”‚  (docker compose)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í’€ í…ŒìŠ¤íŠ¸ / ë¹Œë“œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Frontendâ”‚    â”‚  Docker Backend   â”‚
â”‚  (dev profile)  â”‚    â”‚  (dev profile)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°°í¬
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Frontendâ”‚    â”‚  Docker Backend   â”‚
â”‚  (prod profile) â”‚    â”‚  (prod profile)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ HMR ì‘ë™ í™•ì¸

HMRì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸:

```bash
# 1. ë¡œì»¬ ê°œë°œ ì„œë²„ ì‹œì‘
cd frontend
npm run dev

# 2. ë¸Œë¼ìš°ì € ì½˜ì†” (http://localhost:5110)

# 3. íŒŒì¼ ìˆ˜ì • (ì˜ˆ: app/page.tsx)

# 4. ë¸Œë¼ìš°ì € ìë™ ìƒˆë¡œì¹¨ë¨

# 5. í„°ë¯¸ë„ ì¶œë ¥ í™•ì¸:
# âœ“ Compiled in 123ms
# âœ“ Fast Refresh
```

---

## ğŸš¨ ë¬¸ì œ í•´ê²°

### HMRì´ ì•ˆ ë  ë•Œ

1. **ë°©í™”ë°©í™” ë°©í™”ì¬ í™•ì¸**
   ```bash
   # Windows
   New-Net FirewallRule -DisplayName "Allow Node" -Direction Inbound -LocalPort 5110 -Protocol TCP
   ```

2. **Next.js dev ì„œë²„ê°€ 0.0.0.0ì´ ì•„ë‹Œ 127.0.0.1ë¡œ ë¦¬ìŠ¤ë‹**
   ```javascript
   // next.config.js
   module.exports = {
     experimental: {
       serverActions: {
         bodySizeLimit: '2mb',
       },
     },
     // ...
   }
   ```

3. **ìºì‹œ ì‚­ì œ**
   ```bash
   rm -rf .next
   ```

---

## ìš”ì•½

| ë°©ë²• | ì¶”ì²œ ëŒ€ìƒ | HMR | ì„¤ì • ë‚œì´ë„ |
|------|-----------|-----|----------|
| ë¡œì»¬ ê°œë°œ | ê°œë°œì ê°œì¸ PC | â­â­â­â­â­ | â­ |
| Devcontainer | íŒ€ í”„ë¡œì íŠ¸ | â­â­â­â­ | â­â­â­ |
| Host ë„¤íŠ¸ì›Œí¬ | ë‹¨ì¼ ì„œë¹„ìŠ¤ | â­â­â­ | â­ |
| ì™¸ë¶€ Node | ë³µì¡í•œ í™˜ê²½ | â­â­â­â­ | â­â­ |
| Turbopack | Next.js 15+ | â­â­â­â­ | â­ |
