# 0120X0 (유진 챔피언) 데이터 재검사 보고서

**재검사 일자**: 2026-02-03 04:54
**초기 분석 일자**: 2026-02-03 02:40
**분석자**: Claude Code QA

---

## 1. 요약

### 1.1 현재 상태

| 항목 | 상태 | 내용 |
|------|------|------|
| **DB 데이터** | ✅ 정상 | 최신 데이터(2026-02-03) 저장됨 |
| **API 응답** | ✅ 정상 | 9,985원, volume 12 반환 |
| **프론트엔드 가격** | ✅ 정상 | 9,985원 표시됨 |
| **프론트엔드 업데이트 시간** | ⚠️ 주의 | "오전 9:00:00" 표시 (실제 업데이트 시간 아님) |

### 1.2 6개 시그널 종목 DB 상태

| 종목코드 | 종목명 | 최신 데이터 | 간격 | 가격 |
|----------|--------|-------------|------|------|
| 0120X0 | 유진 챔피언 | **2026-02-03** | **0일** | 9,985원 |
| 217590 | 티엠씨 | 2026-02-02 | 1일 | 14,040원 |
| 0004V0 | 엔비알모션 | 2026-02-02 | 1일 | 20,750원 |
| 0015N0 | 아로마티카 | 2026-02-02 | 1일 | 9,170원 |
| 491000 | 리브스메드 | 2026-02-02 | 1일 | 69,700원 |
| 493330 | 지에프아이 | 2026-02-02 | 1일 | 19,400원 |

---

## 2. DB 데이터 확인

### 2.1 전체 종목 최신 데이터

```sql
SELECT s.ticker, s.name, s.market, sub.latest_date,
       sub.latest_price, (CURRENT_DATE - sub.latest_date) as days_since_update
FROM stocks s
JOIN (
    SELECT ticker, MAX(date) as latest_date,
           MAX(close_price) FILTER (...) as latest_price
    FROM daily_prices
    WHERE ticker IN ('0015N0', '493330', '217590', '0004V0', '491000', '0120X0')
    GROUP BY ticker
) sub ON s.ticker = sub.ticker
ORDER BY days_since_update;
```

**결과**:
- 0120X0: 2026-02-03 (0일 간격) ✅ **가장 최신**
- 기타 5개 종목: 2026-02-02 (1일 간격)

### 2.2 0120X0 상세 데이터

```sql
SELECT date, close_price, volume
FROM daily_prices
WHERE ticker = '0120X0'
ORDER BY date DESC
LIMIT 10;
```

| 날짜 | 종가 | 거래량 |
|------|------|--------|
| 2026-02-03 | 9,985원 | 12 |
| 2026-02-02 | 10,000원 | 0 |
| 2026-01-30 | 10,005원 | 0 |
| 2026-01-29 | 10,005원 | 475 |
| 2026-01-28 | 10,000원 | 0 |
| 2026-01-27 | 10,000원 | 50 |
| 2026-01-26 | 10,000원 | 0 |
| 2026-01-23 | 9,995원 | 0 |
| 2026-01-22 | 9,995원 | 368 |
| 2026-01-21 | 10,000원 | 104,777 |

---

## 3. API 응답 확인

### 3.1 `/api/kr/realtime-prices` 엔드포인트

```bash
curl -X POST http://localhost:5111/api/kr/realtime-prices \
  -H "Content-Type: application/json" \
  -d '{"tickers": ["0120X0"]}'
```

**응답**:
```json
{
  "prices": {
    "0120X0": {
      "ticker": "0120X0",
      "price": 9985.0,
      "change": 0.0,
      "change_rate": 0.0,
      "volume": 12,
      "timestamp": "2026-02-03"
    }
  }
}
```

**분석**:
- `price`: 9985.0 ✅ 정확함
- `volume`: 12 ✅ 정확함
- `timestamp`: "2026-02-03" (날짜만 반환, 시간 없음)

---

## 4. 프론트엔드 상태 확인

### 4.1 UI 표시

```
유진 챔피언중단기크레딧 X클래스
0120X0 • KOSPI
폴링
KOSPI
9,985원
0원 (+0.00%)
거래량 12.00
업데이트 오전 9:00:00        ← 문제: 실제 업데이트 시간 아님
현재 실시간 연결이 없습니다. 15초마다 업데이트됩니다.
```

### 4.2 문제점: 업데이트 시간

| 항목 | 실제 | 표시 |
|------|------|------|
| 가격 | 9,985원 | 9,985원 ✅ |
| 거래량 | 12 | 12.00 ✅ |
| 업데이트 시간 | (API에 없음) | 오전 9:00:00 ⚠️ |

**원인**: API가 `timestamp`를 "2026-02-03" 형식(날짜만)으로 반환하고, 프론트엔드가 시간 정보가 없을 때 기본값으로 "오전 9:00:00"을 사용하는 것으로 추정

---

## 5. 근본 원인 분석

### 5.1 초기 문제 (2026-02-03 02:40 기준)

| 문제 | 원인 |
|------|------|
| 데이터가 2026-01-21에서 멈춤 | 자동 수집 태스크 누락 |

### 5.2 해결 조치

```bash
# 수동으로 수집 태스크 실행
python3 -c "
from src.tasks.collection_tasks import collect_daily_prices
collect_daily_prices('0120X0', '2026-01-22', '2026-02-03')
"
# 결과: 9개 레코드 수집 완료
```

### 5.3 현재 상태 (2026-02-03 04:54 기준)

- ✅ DB에 최신 데이터(2026-02-03) 저장됨
- ✅ API가 정상 가격(9,985원) 반환
- ✅ 프론트엔드에 가격 표시됨
- ⚠️ 업데이트 시간 표시 오류 (API timestamp 형식 문제)

---

## 6. pykrx API 데이터 확인

### 6.1 ELW 거래 중 확인

```python
from pykrx import stock

df = stock.get_market_ohlcv_by_date('20260122', '20260203', '0120X0')
```

**결과**: 9개 데이터 포인트 반환

| 날짜 | 종가 | 거래량 | 등락률 |
|------|------|--------|--------|
| 2026-02-03 | 9,985원 | 12 | -0.15% |
| 2026-02-02 | 10,000원 | 0 | -0.05% |
| 2026-01-30 | 10,005원 | 0 | +0.00% |
| ... | ... | ... | ... |

**결론**: ELW는 여전히 정상 거래 중, 만료 아님

---

## 7. 남은 문제 및 해결 방안

### 7.1 업데이트 시간 표시 문제

**문제**: 프론트엔드에 "오전 9:00:00"으로 표시됨

**원인**: API가 날짜만 반환 (`"timestamp": "2026-02-03"`)

**해결 방안**:

#### 백엔드 수정 (`services/api_gateway/main.py`)

```python
# 변경 전
"timestamp": latest_price.date.isoformat()  # "2026-02-03"

# 변경 후 (시간 정보 추가 또는 현재 시간 사용)
from datetime import datetime, time
"timestamp": datetime.combine(latest_price.date, time.min).isoformat()  # "2026-02-03T00:00:00"
# 또는
"updated_at": datetime.now().isoformat()  # 현재 시간
```

#### 또는 DB 스키마 수정

```sql
-- daily_prices 테이블에 시간 컬럼 추가
ALTER TABLE daily_prices ADD COLUMN updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP;
```

### 7.2 자동 수집 태스크 모니터링

**문제**: 특정 종목(0120X0)의 수집이 누락됨

**해결 방안**:

1. **Celery Beat 로그 모니터링**
   ```bash
   docker logs celery-beat --tail 100 | grep -i "0120X0\|collect"
   ```

2. **데이터 갭 모니터링 쿼리**
   ```sql
   SELECT ticker, name, MAX(date) as latest_date,
          (CURRENT_DATE - MAX(date)::date) as days_gap
   FROM daily_prices dp JOIN stocks s ON s.ticker = dp.ticker
   GROUP BY ticker, name
   HAVING (CURRENT_DATE - MAX(date)::date) > 3
   ORDER BY days_gap DESC;
   ```

3. **알림 시스템**: 3일 이상 업데이트되지 않은 종목 자동 알림

---

## 8. 요약

### 8.1 해결된 문제

| 항목 | 상태 |
|------|------|
| DB 데이터 누락 | ✅ 수동 수집으로 해결 |
| API 가격 반환 | ✅ 정상 작동 |
| 프론트엔드 가격 표시 | ✅ 9,985원 정확히 표시 |

### 8.2 남은 문제

| 항목 | 상태 | 우선순위 |
|------|------|----------|
| 업데이트 시간 "오전 9:00:00" 표시 | ⚠️ | 중 |
| 자동 수집 태스크 누락 방지 | ⚠️ | 높음 |

### 8.3 결론

1. **0120X0 데이터는 복구됨**: DB에 최신 데이터(2026-02-03, 9,985원) 저장 완료
2. **ELW 만료 아님**: pykrx API를 통해 정상 거래 중 확인
3. **프론트엔드 가격 표시 정상**: 9,985원이 올바르게 표시됨
4. **시간 표시 문제**: API timestamp 형식 개선 필요

---

*보고서 작성일: 2026-02-03*
*버전: 2.0 (재검사)*
