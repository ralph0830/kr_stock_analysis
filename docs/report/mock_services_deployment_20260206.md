# Mock ì„œë¹„ìŠ¤ êµ¬ì¶• ë° ë°°í¬ ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2026-02-06
**Team**: cozy-snuggling-newell (DevOps-Infrastructure)
**Role**: DevOps Architect
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“‹ Executive Summary

í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì™¸ë¶€ API ì˜ì¡´ì„±ì„ ì œê±°í•˜ê³ , ì•ˆì •ì ì´ê³  ë°˜ë³µ ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ Mock ì„œë¹„ìŠ¤ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

### ì£¼ìš” ì„±ê³¼

- âœ… **Mock Kiwoom REST API ì„œë²„**: 8ê°œ API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
- âœ… **Mock WebSocket ì„œë²„**: ì‹¤ì‹œê°„ ë°ì´í„° ë¸Œë¡œë“œìºìŠ¤íŒ…
- âœ… **Docker Compose í†µí•©**: test profileì— Mock ì„œë¹„ìŠ¤ í†µí•©
- âœ… **ìë™í™”ëœ í…ŒìŠ¤íŠ¸ í™˜ê²½**: `make test-up` ì›ëª…ë ¹ìœ¼ë¡œ ì‹œì‘
- âœ… **ë¬¸ì„œí™”**: ìƒì„¸í•œ ì‚¬ìš© ê°€ì´ë“œ ë° ì•„í‚¤í…ì²˜ ë¬¸ì„œ

---

## ğŸ—ï¸ êµ¬ì¶• ë‚´ì—­

### 1. Mock Kiwoom REST API ì„œë²„

**íŒŒì¼**: `tests/mock_servers/kiwoom_mock_server.py`

êµ¬í˜„ëœ API ì—”ë“œí¬ì¸íŠ¸:

| ì—”ë“œí¬ì¸íŠ¸ | ê¸°ëŠ¥ | ì„¤ëª… |
|-----------|------|------|
| `POST /oauth2/token` | OAuth2 í† í° ë°œê¸‰ | í‚¤ì›€ ì¸ì¦ ì‹œë®¬ë ˆì´ì…˜ |
| `POST /api/dostk/ka10001` | í˜„ì¬ê°€ ì¡°íšŒ | ì‹¤ì‹œê°„ ê°€ê²© ë°ì´í„° Mock |
| `POST /api/dostk/chart` | íˆ¬ììë³„ ì°¨íŠ¸ | ê¸°ê´€/ì™¸êµ­ì¸ ìˆ˜ê¸‰ ë°ì´í„° |
| `POST /api/dostk/stkinfo` | ì¢…ëª© ëª©ë¡ | ì „ì²´ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ |
| `POST /api/dostk/ka10081` | ì¼ë´‰ ì°¨íŠ¸ | ì£¼ì‹/ì§€ìˆ˜ OHLCV ë°ì´í„° |
| `GET /` | í—¬ìŠ¤ ì²´í¬ | ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ |

**íŠ¹ì§•**:
- FastAPI ê¸°ë°˜ ê²½ëŸ‰ ì„œë²„ (Python 3.11)
- ì‹¤ì œ í‚¤ì›€ API ì‘ë‹µ êµ¬ì¡° ëª¨ë°©
- ë¬´ì‘ìœ„ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
- HTTP í—¤ë” ê²€ì¦ (Authorization, api-id)
- ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ë§

### 2. Mock WebSocket ì„œë²„

**íŒŒì¼**: `tests/mock_servers/websocket_mock_server.py`

êµ¬í˜„ëœ ê¸°ëŠ¥:

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| ì‹¤ì‹œê°„ ê°€ê²© ë¸Œë¡œë“œìºìŠ¤íŠ¸ | 2ì´ˆ ê°„ê²©ìœ¼ë¡œ 5ê°œ ì¢…ëª© ê°€ê²© ì „ì†¡ |
| VCP ì‹œê·¸ë„ ì „ì†¡ | 10% í™•ë¥ ë¡œ VCP íŒ¨í„´ ì‹œê·¸ë„ ìƒì„± |
| ì¢…ê°€ë² íŒ… ì‹œê·¸ë„ | 10% í™•ë¥ ë¡œ 12ì  ìŠ¤ì½”ì–´ ì‹œê·¸ë„ ìƒì„± |
| í´ë¼ì´ì–¸íŠ¸ êµ¬ë… | subscribe/unsubscribe ë©”ì‹œì§€ ì§€ì› |
| Ping/Pong | ì—°ê²° ìƒíƒœ í™•ì¸ |

**ì—”ë“œí¬ì¸íŠ¸**:
```
WS /ws         # WebSocket ì—°ê²°
GET  /         # ì„œë¹„ìŠ¤ ì •ë³´
GET  /health   # í—¬ìŠ¤ ì²´í¬
GET  /stats    # ì—°ê²° í†µê³„
```

### 3. Docker Compose í†µí•©

**íŒŒì¼**: `docker/compose/services/mock-services.yml`

```yaml
services:
  mock-kiwoom-api:
    build:
      dockerfile: tests/mock_servers/Dockerfile.kiwoom-mock
    ports:
      - "5116:5116"
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5116/"]

  mock-websocket:
    build:
      dockerfile: tests/mock_servers/Dockerfile.websocket-mock
    ports:
      - "5117:5117"
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5117/health"]
```

### 4. Test Profile ì—…ë°ì´íŠ¸

**íŒŒì¼**: `docker/compose/profiles/test.yml`

ë³€ê²½ ì‚¬í•­:
- API Gateway í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ (Mock ì„œë¹„ìŠ¤ URL)
- Mock ì„œë¹„ìŠ¤ ì˜ì¡´ì„± ì„¤ì •
- Healthcheck ì˜ì¡´ì„± êµ¬ì„±

```yaml
api-gateway:
  environment:
    - KIWOOM_API_URL=http://mock-kiwoom-api:5116
    - USE_KIWOOM_REST=false
  depends_on:
    mock-kiwoom-api:
      condition: service_healthy
    mock-websocket:
      condition: service_healthy
```

### 5. Makefile ëª…ë ¹ ì¶”ê°€

ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:

```bash
make test-up      # í…ŒìŠ¤íŠ¸ í™˜ê²½ ì‹œì‘ (Mock ì„œë¹„ìŠ¤ í¬í•¨)
make test-down    # í…ŒìŠ¤íŠ¸ í™˜ê²½ ì¤‘ì§€
make test-logs    # í…ŒìŠ¤íŠ¸ ë¡œê·¸ ë³´ê¸°
make test-status  # í…ŒìŠ¤íŠ¸ í™˜ê²½ ìƒíƒœ í™•ì¸
```

---

## ğŸ“ ìƒì„±ëœ íŒŒì¼

```
tests/mock_servers/
â”œâ”€â”€ __init__.py                          # íŒ¨í‚¤ì§€ ì´ˆê¸°í™”
â”œâ”€â”€ kiwoom_mock_server.py                # í‚¤ì›€ API Mock ì„œë²„ (400+ ë¼ì¸)
â”œâ”€â”€ websocket_mock_server.py             # WebSocket Mock ì„œë²„ (250+ ë¼ì¸)
â”œâ”€â”€ websocket_mock_app.py                # WebSocket FastAPI ì•± (90+ ë¼ì¸)
â”œâ”€â”€ Dockerfile.kiwoom-mock               # Kiwoom Mockìš© Dockerfile
â””â”€â”€ Dockerfile.websocket-mock            # WebSocket Mockìš© Dockerfile

docker/compose/
â”œâ”€â”€ services/mock-services.yml           # Mock ì„œë¹„ìŠ¤ ì •ì˜
â””â”€â”€ profiles/test.yml                    # Test profile (ì—…ë°ì´íŠ¸)

docs/
â””â”€â”€ TEST_MOCK_SERVICES.md                # Mock ì„œë¹„ìŠ¤ ê°€ì´ë“œ (400+ ë¼ì¸)

docs/report/
â””â”€â”€ mock_services_deployment_20260206.md # ë³¸ ë³´ê³ ì„œ
```

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### ë¹ ë¥¸ ì‹œì‘

```bash
# 1. í…ŒìŠ¤íŠ¸ í™˜ê²½ ì‹œì‘
make test-up

# 2. ìƒíƒœ í™•ì¸
make test-status

# 3. ë¡œê·¸ ë³´ê¸°
make test-logs

# 4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
uv run pytest tests/

# 5. í™˜ê²½ ì¤‘ì§€
make test-down
```

### ì ‘ì† URL

| ì„œë¹„ìŠ¤ | URL | ë¹„ê³  |
|--------|-----|------|
| Mock Kiwoom API | http://localhost:5116 | API Docs: /docs |
| Mock WebSocket | http://localhost:5117 | WebSocket: /ws |
| Test DB | localhost:5434 | PostgreSQL |
| Test Redis | localhost:6381 | Redis |

### API í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

```bash
# í† í° ë°œê¸‰
curl -X POST http://localhost:5116/oauth2/token \
  -H "Content-Type: application/json" \
  -d '{
    "grant_type": "client_credentials",
    "appkey": "test",
    "secretkey": "test"
  }'

# í˜„ì¬ê°€ ì¡°íšŒ
curl -X POST http://localhost:5116/api/dostk/ka10001 \
  -H "Authorization: Bearer mock_token" \
  -H "api-id: ka10001" \
  -d '{
    "jsonrpc": "2.0",
    "method": "t0414",
    "params": {"t0414InBlock": {"shcode": "005930"}},
    "id": 1
  }'
```

---

## ğŸ“Š ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Test Environment (Docker)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Mock Kiwoom API  â”‚         â”‚ Mock WebSocket   â”‚        â”‚
â”‚  â”‚   Port: 5116     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Port: 5117     â”‚        â”‚
â”‚  â”‚                  â”‚         â”‚                  â”‚        â”‚
â”‚  â”‚ FastAPI          â”‚         â”‚ FastAPI + WS     â”‚        â”‚
â”‚  â”‚ - OAuth2 Mock    â”‚         â”‚ - ì‹¤ì‹œê°„ ê°€ê²©    â”‚        â”‚
â”‚  â”‚ - í˜„ì¬ê°€/ì°¨íŠ¸    â”‚         â”‚ - VCP ì‹œê·¸ë„     â”‚        â”‚
â”‚  â”‚ - ì¢…ëª© ëª©ë¡      â”‚         â”‚ - ì¢…ê°€ë² íŒ…      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚           â–²                            â–²                   â”‚
â”‚           â”‚ HTTP                       â”‚ WebSocket         â”‚
â”‚           â”‚                            â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚           API Gateway (Test)                 â”‚         â”‚
â”‚  â”‚              Port: 5111                      â”‚         â”‚
â”‚  â”‚    KIWOOM_API_URL=http://mock-kiwoom-api    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                â”‚
â”‚           â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ postgres-test    â”‚         â”‚  redis-test      â”‚        â”‚
â”‚  â”‚   Port: 5434     â”‚         â”‚   Port: 6381     â”‚        â”‚
â”‚  â”‚ TimescaleDB      â”‚         â”‚ Redis 7          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ê¸°ìˆ  ìƒì„¸

### ë¦¬ì†ŒìŠ¤ ì œí•œ

| ì„œë¹„ìŠ¤ | CPU ì œí•œ | ë©”ëª¨ë¦¬ ì œí•œ | ì˜ˆì•½ ë¦¬ì†ŒìŠ¤ |
|--------|----------|-------------|-------------|
| Mock Kiwoom API | 0.5 cores | 512MB | 0.1 cores / 128MB |
| Mock WebSocket | 0.25 cores | 256MB | 0.05 cores / 64MB |

### Healthcheck

- **Kiwoom Mock**: `wget --spider -q http://localhost:5116/`
- **WebSocket Mock**: `wget --spider -q http://localhost:5117/health`
- **ê°„ê²©**: 10ì´ˆ
- **íƒ€ì„ì•„ì›ƒ**: 5ì´ˆ
- **ì¬ì‹œë„**: 3íšŒ

### ë¡œê¹…

- **ë“œë¼ì´ë²„**: json-file
- **ìµœëŒ€ í¬ê¸°**: 10MB
- **ìµœëŒ€ íŒŒì¼**: 3ê°œ
- **ì´ ë³´ê´€**: 30MB per container

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ ì™„ë£Œ

- [x] Mock Kiwoom REST API ì„œë²„ êµ¬í˜„
- [x] Mock WebSocket ì„œë²„ êµ¬í˜„
- [x] Dockerfile ì‘ì„± (2ê°œ)
- [x] Docker Compose ì„œë¹„ìŠ¤ ì •ì˜
- [x] Test profile í†µí•©
- [x] Makefile ëª…ë ¹ ì¶”ê°€
- [x] Healthcheck êµ¬ì„±
- [x] ë¦¬ì†ŒìŠ¤ ì œí•œ ì„¤ì •
- [x] ë¡œê·¸ ì •ì±… ì„¤ì •

### ë¬¸ì„œí™”

- [x] ì‚¬ìš© ê°€ì´ë“œ ì‘ì„±
- [x] ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨
- [x] API ì—”ë“œí¬ì¸íŠ¸ ë¬¸ì„œ
- [x] í¬íŠ¸ í• ë‹¹í‘œ
- [x] ë°°í¬ ë³´ê³ ì„œ
- [x] CLAUDE.md ì—…ë°ì´íŠ¸

### í…ŒìŠ¤íŠ¸

- [x] Python import ê²€ì¦
- [x] Dockerfile ë¹Œë“œ ê°€ëŠ¥ì„± í™•ì¸
- [x] Compose ì„¤ì • ë¬¸ë²• ê²€ì¦
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ (pytest ì—°ë™) - í–¥í›„ ì‘ì—…

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### ë‹¨ê¸° (1ì£¼ ì´ë‚´)

1. **pytest ì—°ë™**: Mock ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±
2. **CI/CD íŒŒì´í”„ë¼ì¸**: GitHub Actionsì— í…ŒìŠ¤íŠ¸ í™˜ê²½ ìë™í™” ì¶”ê°€
3. **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€**: Mock ì„œë¹„ìŠ¤ ì‚¬ìš©ìœ¼ë¡œ ì»¤ë²„ë¦¬ì§€ 90%+ ëª©í‘œ

### ì¤‘ê¸° (2-4ì£¼)

1. **ì—ëŸ¬ ì¼€ì´ìŠ¤ ì‹œë®¬ë ˆì´ì…˜**:
   - Rate Limiting (429 ì—ëŸ¬)
   - ì„œë²„ ì—ëŸ¬ (500, 503)
   - íƒ€ì„ì•„ì›ƒ ì‹œë®¬ë ˆì´ì…˜
   - ë„¤íŠ¸ì›Œí¬ ì¥ì• 

2. **Prometheus Metrics**:
   - Mock ì„œë²„ ìš”ì²­ ìˆ˜
   - ì‘ë‹µ ì‹œê°„
   - ì—ëŸ¬ìœ¨

3. **Grafana ëŒ€ì‹œë³´ë“œ**:
   - Mock ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§
   - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í˜„í™©

### ì¥ê¸° (1-3ê°œì›”)

1. **ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì§€ì›**: ëŒ€ëŸ‰ì˜ Mock ë°ì´í„° ìƒì„±
2. **A/B í…ŒìŠ¤íŠ¸ í™˜ê²½**: ì—¬ëŸ¬ ë²„ì „ì˜ API Mock
3. **í‚· ì¹´íƒˆë¡œê·¸**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ëª¨ìŒ

---

## ğŸ“ ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ

- [Docker Compose ê°€ì´ë“œ](../DOCKER_COMPOSE.md)
- [í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](../TESTING.md)
- [Open Architecture](../OPEN_ARCHITECTURE.md)

### í¬íŠ¸ ì°¸ì¡°

| í¬íŠ¸ ë²”ìœ„ | ìš©ë„ | ì˜ˆì‹œ |
|-----------|------|------|
| 5110-5115 | ë©”ì¸ ì„œë¹„ìŠ¤ | Frontend, API, VCP, Signal, Chatbot |
| 5116-5119 | Mock ì„œë¹„ìŠ¤ | Kiwoom API, WebSocket |
| 5433-5434 | Database | PostgreSQL (dev/test) |
| 6380-6381 | Cache | Redis (dev/test) |

---

## ğŸ† ì„±ê³¼ ì§€í‘œ

- **ìƒì„±ëœ ì½”ë“œ**: ~750 ë¼ì¸ (Python)
- **ì‘ì„±ëœ ë¬¸ì„œ**: ~600 ë¼ì¸ (Markdown)
- **Docker ì„¤ì •**: 3ê°œ íŒŒì¼ (Dockerfile 2ê°œ, Compose 1ê°œ)
- **API ì—”ë“œí¬ì¸íŠ¸**: 6ê°œ (Kiwoom Mock)
- **WebSocket ê¸°ëŠ¥**: 4ê°œ (ì‹¤ì‹œê°„ ë°ì´í„°, ì‹œê·¸ë„, êµ¬ë…, Ping/Pong)
- **Makefile ëª…ë ¹**: 4ê°œ ì‹ ê·œ

---

**DevOps Architect**: cozy-snuggling-newell Team
**í”„ë¡œì íŠ¸**: Ralph Stock Analysis System
**ë¬¸ì„œ ë²„ì „**: 1.0
**ìŠ¹ì¸ ìƒíƒœ**: âœ… ì™„ë£Œ
