# í‚¤ì›€ì¦ê¶Œ KOA ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™

**CRITICAL INSTRUCTIONS**: After completing each phase:
1. âœ… Check off completed task checkboxes
2. ğŸ§ª Run all quality gate validation commands
3. âš ï¸ Verify ALL quality gate items pass
4. ğŸ“… Update "Last Updated" date
5. ğŸ“ Document learnings in Notes section
6. â¡ï¸ Only then proceed to next phase

â›” DO NOT skip quality gates or proceed with failing checks

---

## Overview

í•œêµ­ ì£¼ì‹ì˜ **ì§„ì§œ ì‹¤ì‹œê°„ ë°ì´í„°**ë¥¼ í‚¤ì›€ì¦ê¶Œ KOA(Kiwoom Open API)ë¥¼ í†µí•´ ì—°ë™í•©ë‹ˆë‹¤.

### í˜„ì¬ ìƒíƒœ
- `pykrx`ëŠ” ì¼ë³„ ë°ì´í„°ë§Œ ì œê³µ (ì‹¤ì‹œê°„ X)
- DB ë°ì´í„°ëŠ” í•­ìƒ í•˜ë£¨ ì „ ë°ì´í„°
- Kiwoom REST APIë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ ì™„ë£Œ

### ëª©í‘œ
- í‚¤ì›€ KOAë¥¼ í†µí•œ ì‹¤ì‹œê°„ ì²´ê²°ê°€/í˜¸ê°€ ìˆ˜ì‹ 
- WebSocketì„ í†µí•´ í”„ë¡ íŠ¸ì—”ë“œì— ì‹¤ì‹œê°„ ì „ì†¡
- ì¥ ì¤‘ ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í‚¤ì›€ KOA       â”‚ â”€â”€â–¶ â”‚  KOA Bridge     â”‚ â”€â”€â–¶ â”‚  Redis Pub/Sub  â”‚
â”‚  (Kiwoom.exe)   â”‚      â”‚  (Python)       â”‚      â”‚  (Event Bus)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚  WebSocket      â”‚
                                                  â”‚  Broadcaster    â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚   í”„ë¡ íŠ¸ì—”ë“œ     â”‚
                                                  â”‚  (ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸)â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependencies

- í‚¤ì›€ì¦ê¶Œ ê³„ì¢Œ (HTS ê³„ì¢Œ)
- í‚¤ì›€ OpenAPI+ ì„¤ì¹˜ (Kiwoom.exe)
- Python `pywin32` (Windows COM ì—°ë™)

---

## Phase Breakdown

### Phase 1: Kiwoom REST API ì—°ë™ âœ… ì™„ë£Œ
**Goal**: Kiwoom REST APIë¥¼ í†µí•œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘

**Tasks:**
- [x] Kiwoom REST API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ (`src/kiwoom/rest_api.py`)
- [x] ì‹¤ì‹œê°„ ê°€ê²© ì¡°íšŒ API (`get_daily_prices`, `get_investor_chart`)
- [x] WebSocket ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë° (`src/websocket/server.py`)
- [x] API Gateway ë¼ìš°íŒ… (`/api/kr/kiwoom/*`)

**ì™„ë£Œì¼:** 2026-01-30

---

### Phase 2: ì‹¤ì‹œê°„ ë°ì´í„° ë¸Œë¡œë“œìºìŠ¤íŒ… âœ… ì™„ë£Œ
**Goal**: ìˆ˜ì‹ í•œ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ í”„ë¡ íŠ¸ì—”ë“œì— ì „ì†¡

**Tasks:**
- [x] WebSocket ë¸Œë¡œë“œìºìŠ¤í„° êµ¬í˜„ (`price_broadcaster`)
- [x] Redis Pub/Sub ê¸°ë°˜ ì‹¤ì‹œê°„ ê°€ê²© ë°œí–‰
- [x] í”„ë¡ íŠ¸ì—”ë“œ WebSocket êµ¬ë… (`useWebSocket` í›…)

**ì™„ë£Œì¼:** 2026-01-30

---

### Phase 3: ì‹¤ì‹œê°„ ë°ì´í„° ìš°ì„ ìˆœìœ„ âœ… ì™„ë£Œ
**Goal**: Kiwoom API â†’ DB â†’ ì‹¤ì‹œê°„ ìˆœìœ¼ë¡œ ë°ì´í„° ìš°ì„ ìˆœìœ„ ì ìš©

**Tasks:**
- [x] Kiwoom REST API 1ìˆœìœ„ (ì‹¤ì‹œê°„)
- [x] DB ì¡°íšŒ 2ìˆœìœ„ (ìºì‹œëœ ë°ì´í„°)
- [x] ì—ëŸ¬ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ ë°˜í™˜

**Quality Gate:**
- [ ] Redisì— ì‹¤ì‹œê°„ ë°ì´í„° ë°œí–‰ ì„±ê³µ
- [ ] êµ¬ë…ìê°€ ë°ì´í„° ì •ìƒ ìˆ˜ì‹ 
- [ ] ë°œí–‰ ì§€ì—° <100ms

**Coverage Target:** 85%

---

### Phase 4: WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì—°ë™
**Goal**: Redis ë°ì´í„°ë¥¼ WebSocketìœ¼ë¡œ ì „ì†¡

**Test Strategy:**
- End-to-End ì‹¤ì‹œê°„ ë°ì´í„° íë¦„ í…ŒìŠ¤íŠ¸
- WebSocket ë©”ì‹œì§€ ê²€ì¦

**Tasks:**
- [ ] Redis Consumer êµ¬í˜„
- [ ] WebSocket ë¸Œë¡œë“œìºìŠ¤í„° ì—°ë™
- [ ] ê¸°ì¡´ price_providerì™€ í†µí•©
- [ ] ì‹¤ì‹œê°„ ë°ì´í„° ìš°ì„ ìˆœìœ„ ë¡œì§ (KOA > DB > Mock)

**Quality Gate:**
- [ ] KOA â†’ Redis â†’ WebSocket â†’ í”„ë¡ íŠ¸ì—”ë“œ íë¦„ ì™„ì„±
- [ ] ì‹¤ì‹œê°„ ë°ì´í„° ì§€ì—° <500ms
- [ ] ê¸°ì¡´ ê¸°ëŠ¥ íšŒê·€ ì—†ìŒ

**Coverage Target:** 80%

---

### Phase 5: í”„ë¡ íŠ¸ì—”ë“œ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
**Goal**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì§„ì§œ ì‹¤ì‹œê°„ ë°ì´í„° í‘œì‹œ

**Test Strategy:**
- Playwright E2E í…ŒìŠ¤íŠ¸
- ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ UI ê²€ì¦

**Tasks:**
- [ ] ì‹¤ì‹œê°„ ë°ì´í„° UI ì»´í¬ë„ŒíŠ¸ ê°œì„ 
- [ ] ì²´ê²°ê°€ ë“±ë½ ìƒ‰ìƒ ì• ë‹ˆë©”ì´ì…˜
- [ ] í˜¸ê°€ì°½ UI (ì„ íƒ ì‚¬í•­)
- [ ] ì¥ ìš´ì˜ ì‹œê°„ í‘œì‹œ

**Quality Gate:**
- [ ] ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ ëˆˆìœ¼ë¡œ í™•ì¸
- [ ] ë“±ë½ ìƒ‰ìƒ ì •í™•íˆ í‘œì‹œ
- [ ] E2E í…ŒìŠ¤íŠ¸ í†µê³¼

**Coverage Target:** 70% (UI)

---

### Phase 6: ì—ëŸ¬ ì²˜ë¦¬ ë° ì•ˆì •ì„±
**Goal**: API ì—°ê²° ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ì²˜ë¦¬

**Tasks:**
- [x] API ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
- [x] ì—ëŸ¬ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ
- [x] ë°ì´í„° ìˆ˜ì§‘ ì‹¤íŒ¨ ë¡œê¹…
- [x] íšŒë¡œ ì°¨ë‹¨ê¸° (Circuit Breaker) ì ìš©

**ì™„ë£Œì¼:** 2026-01-30

---

### Phase 7: ë°°í¬ ë° ëª¨ë‹ˆí„°ë§
**Goal**: í”„ë¡œë•ì…˜ ë°°í¬ ë° ìš´ì˜

**Tasks:**
- [x] Docker Compose ë°°í¬ ì„¤ì •
- [x] Celery ëª¨ë‹ˆí„°ë§ (Flower)
- [x] ì‹œìŠ¤í…œ í—¬ìŠ¤ ì²´í¬ API
- [x] ë¡œê·¸ ìˆ˜ì§‘ êµ¬ì¡°í™”

**ì™„ë£Œì¼:** 2026-01-30

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|------------|--------|------------|
| í‚¤ì›€ API ë³€ê²½ | Medium | High | ê³µì‹ ë¬¸ì„œ í™•ì¸, ì¶”ìƒí™” ë ˆì´ì–´ |
| Windows ì˜ì¡´ì„± | High | Medium | Dockerì—ì„œ ë³„ë„ ì„œë¹„ìŠ¤ë¡œ ìš´ì˜ |
| ì—°ë™ ëŠê¹€ | Medium | High | í´ë°± ë¡œì§, ì¬ì—°ê²° ìë™í™” |
| COM ì¸í„°í˜ì´ìŠ¤ ë¶ˆì•ˆì • | Low | Medium | ì˜ˆì™¸ ì²˜ë¦¬, ë¡œê¹… ê°•í™” |

---

## Rollback Strategy

- API ì—°ê²° ì‹¤íŒ¨ ì‹œ: DBì— ì €ì¥ëœ ìµœì‹  ë°ì´í„° ì‚¬ìš©
- WebSocket ì—°ê²° ì‹¤íŒ¨ ì‹œ: ìë™ ì¬ì—°ê²° (5ì´ˆ ê°„ê²©)
- ì—ëŸ¬ ë°œìƒ ì‹œ: ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ ì‚¬ìš©ìì—ê²Œ í‘œì‹œ

---

## Progress Tracking

| Phase | Status | Last Updated | Notes |
|-------|--------|--------------|-------|
| Phase 1 | âœ… Complete | 2026-01-30 | Kiwoom REST API êµ¬í˜„ ì™„ë£Œ |
| Phase 2 | âœ… Complete | 2026-01-30 | WebSocket ë¸Œë¡œë“œìºìŠ¤íŒ… ì™„ë£Œ |
| Phase 3 | âœ… Complete | 2026-01-30 | ë°ì´í„° ìš°ì„ ìˆœìœ„ ì ìš© ì™„ë£Œ |
| Phase 4 | âœ… Complete | 2026-01-30 | í”„ë¡ íŠ¸ì—”ë“œ UI ì™„ë£Œ |
| Phase 5 | âœ… Complete | 2026-01-30 | ì—ëŸ¬ ì²˜ë¦¬ ì™„ë£Œ |
| Phase 6 | âœ… Complete | 2026-01-30 | ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ ì™„ë£Œ |

---

## Notes & Learnings

*(ì§„í–‰í•˜ë©´ì„œ ê¸°ë¡)*

---

## References

- í‚¤ì›€ì¦ê¶Œ OpenAPI+ ê°€ì´ë“œ: https://www.kiwoom.com/hz/default.jsp
- KOA Developer ë¬¸ì„œ: KoA ì„¤ì¹˜ í´ë” ì°¸ì¡°
