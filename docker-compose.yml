# Ralph Stock Analysis - Docker Compose (Profiles-based)
# =============================================================================
# Profiles 기반 통합 Docker Compose 설정
#
# 사용법:
#   docker compose --profile dev up -d     # 개발 환경 (핫 리로드)
#   docker compose --profile prod up -d    # 운영 환경 (최적화)
#   docker compose --profile dev logs -f   # 로그 보기
#   docker compose down                    # 전체 중지
#
# Profiles:
#   - dev: 개발용 (소스 마운트, 핫 리로드, 디버깅)
#   - prod: 운영용 (빌드된 이미지, 리소스 제한)
# =============================================================================

# Include modular service files
include:
  - docker/compose/infra.yml
  - docker/compose/services/api-gateway.yml
  - docker/compose/services/vcp-scanner.yml
  - docker/compose/services/signal-engine.yml
  - docker/compose/services/chatbot.yml
  - docker/compose/services/frontend.yml
  - docker/compose/services/celery.yml

# Application services with profiles
# Build context is overridden to be project root relative
services:
  api-gateway:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/api-gateway.yml
      service: api-gateway
    build:
      context: .
      dockerfile: services/api_gateway/Dockerfile

  vcp-scanner:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/vcp-scanner.yml
      service: vcp-scanner
    build:
      context: .
      dockerfile: services/vcp_scanner/Dockerfile

  signal-engine:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/signal-engine.yml
      service: signal-engine
    build:
      context: .
      dockerfile: services/signal_engine/Dockerfile

  chatbot:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/chatbot.yml
      service: chatbot
    build:
      context: .
      dockerfile: services/chatbot/Dockerfile

  frontend:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/frontend.yml
      service: frontend
    build:
      context: ./frontend

  celery-worker:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/celery.yml
      service: celery-worker
    build:
      context: .
      dockerfile: Dockerfile.worker

  celery-beat:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/celery.yml
      service: celery-beat
    build:
      context: .
      dockerfile: Dockerfile.worker

  flower:
    profiles: [dev, prod]
    extends:
      file: docker/compose/services/celery.yml
      service: flower

# Network and volumes are defined in infra.yml
