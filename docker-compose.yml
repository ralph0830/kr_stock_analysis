# Ralph Stock Analysis - 통합 Docker Compose 설정
# =============================================================================
# Profiles 기반 단일 진입점 구성
#
# 사용법:
#   docker compose --profile dev up -d     # 개발 환경 (핫 리로드)
#   docker compose --profile prod up -d    # 운영 환경 (최적화)
#   docker compose --profile test up -d    # 테스트 환경
#   docker compose down                    # 전체 중지
#
# Profiles:
#   - dev:  개발용 (소스 마운트, 핫 리로드, 디버깅)
#   - prod: 운영용 (빌드된 이미지, 리소스 제한)
#   - test: 테스트용 (테스트 DB, 자동 정리)
# =============================================================================
#
# @see docs/DOCKER_COMPOSE.md 상세 가이드 참조
# =============================================================================

include:
  # 인프라 서비스 (PostgreSQL, Redis)
  - docker/compose/infra.yml
  # 모듈화된 서비스 정의
  - docker/compose/services/db-init.yml
  - docker/compose/services/api-gateway.yml
  - docker/compose/services/vcp-scanner.yml
  - docker/compose/services/signal-engine.yml
  - docker/compose/services/daytrading-scanner.yml
  - docker/compose/services/chatbot.yml
  - docker/compose/services/frontend.yml
  - docker/compose/services/celery.yml
  # Profile 오버라이드 (dev/prod/test)
  - docker/compose/profiles/dev.yml
  - docker/compose/profiles/prod.yml
  - docker/compose/profiles/test.yml
  # Mock 서비스 (테스트용) - test profile에서만 include
  # - docker/compose/services/mock-services.yml

# Application services with profiles
services:
  db-init:
    profiles: [dev, prod, test]
    env_file:
      - .env

  api-gateway:
    profiles: [dev, prod, test]
    env_file:
      - .env

  vcp-scanner:
    profiles: [dev, prod]
    env_file:
      - .env

  signal-engine:
    profiles: [dev, prod]
    env_file:
      - .env

  daytrading-scanner:
    profiles: [dev, prod]
    env_file:
      - .env

  chatbot:
    profiles: [dev, prod]
    env_file:
      - .env

  celery-worker:
    profiles: [dev, prod]
    env_file:
      - .env

  celery-beat:
    profiles: [dev, prod]
    env_file:
      - .env

  flower:
    profiles: [dev, prod]

  frontend:
    profiles: [dev, prod]

  # Mock 서비스 (테스트용)
  mock-kiwoom-api:
    profiles: [test]
    env_file:
      - .env

  mock-websocket:
    profiles: [test]
    env_file:
      - .env
