# AlertManager ì„¤ì •

global:
  resolve_timeout: 5m

# ì•Œë¦¼ ë¼ìš°íŒ…
route:
  group_by: ['alertname', 'cluster', 'service', 'component']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  routes:
    # Critical ì•Œë¦¼ (ì¦‰ì‹œ)
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m

    # Warning ì•Œë¦¼ (5ë¶„ ëŒ€ê¸°)
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 5m
      repeat_interval: 1h

    # Info ì•Œë¦¼ (1ì‹œê°„ ëŒ€ê¸°)
    - match:
        severity: info
      receiver: 'info-alerts'
      group_wait: 1h
      repeat_interval: 24h

# ìˆ˜ì‹ ì ì„¤ì •
receivers:
  - name: 'default'
    slack_configs:
      - channel: '#alerts'
        send_resolved: true
        title: 'ğŸš¨ {{ .GroupLabels.alertname }}'
        text: |
          *Summary*: {{ .CommonAnnotations.summary }}
          *Description*: {{ .CommonAnnotations.description }}
          *Severity*: {{ .CommonLabels.severity }}
          *Service*: {{ .CommonLabels.service }}
          {% if .CommonAnnotations.runbook %}*Runbook*: {{ .CommonAnnotations.runbook }}{% endif %}
          * Grafana: https://grafana.ralphpark.com/d/default *

  - name: 'critical-alerts'
    slack_configs:
      - channel: '#alerts-critical'
        send_resolved: true
        title: 'ğŸ”´ CRITICAL: {{ .GroupLabels.alertname }}'
        color: 'danger'
        text: |
          *Summary*: {{ .CommonAnnotations.summary }}
          *Description*: {{ .CommonAnnotations.description }}
          *Severity*: {{ .CommonLabels.severity }}
          *Service*: {{ .CommonLabels.service }}
          *Instance*: {{ .CommonLabels.instance }}
          {% if .CommonAnnotations.runbook %}*Runbook*: {{ .CommonAnnotations.runboard }}{% endif %}
        actions:
          - type: button
            text: 'View in Grafana'
            url: 'https://grafana.ralphpark.com/d/default'
          - type: button
            text: 'Silence'
            url: '{{ .ExternalURL }}/#/silences/new?filter=%7B'

    # Email ì•Œë¦¼ (ì„ íƒì‚¬í•­ - SMTP ì„¤ì • í•„ìš”)
    # email_configs:
    #   - to: 'admin@ralphpark.com'
    #     from: 'alertmanager@ralphpark.com'
    #     smarthost: 'smtp.gmail.com:587'
    #     auth_username: 'your-email@gmail.com'
    #     auth_password: 'your-app-password'
    #     send_resolved: true

  - name: 'warning-alerts'
    slack_configs:
      - channel: '#alerts-warning'
        send_resolved: true
        title: 'âš ï¸ WARNING: {{ .GroupLabels.alertname }}'
        color: 'warning'
        text: |
          *Summary*: {{ .CommonAnnotations.summary }}
          *Description*: {{ .CommonAnnotations.description }}
          *Severity*: {{ .CommonLabels.severity }}
          *Service*: {{ .CommonLabels.service }}

  - name: 'info-alerts'
    slack_configs:
      - channel: '#alerts-info'
        send_resolved: true
        title: 'â„¹ï¸ INFO: {{ .GroupLabels.alertname }}'
        color: 'good'
        text: |
          *Summary*: {{ .CommonAnnotations.summary }}
          *Description*: {{ .CommonAnnotations.description }}

# ì–µì œ ê·œì¹™ (ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€)
inhibit_rules:
  # Criticalì´ ë°œìƒí•˜ë©´ related warning ì–µì œ
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance', 'service']

  # ServiceDownì´ ë°œìƒí•˜ë©´ related errors ì–µì œ
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*Error.*|.*Failed.*'
    equal: ['instance']
