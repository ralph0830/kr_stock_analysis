# Database Initialization Service
# ì¼íšŒì„± ì‹¤í–‰ìœ¼ë¡œ DB í…Œì´ë¸” ìƒì„± ë° TimescaleDB ì„¤ì •

services:
  db-init:
    build:
      context: ../../../
      dockerfile: services/api_gateway/Dockerfile
      target: development
    image: api-gateway:dev
    container_name: ralph-db-init
    restart: "no"  # ì¼íšŒì„± ì‹¤í–‰
    env_file:
      - ../../../.env
    environment:
      DATABASE_URL: postgresql://postgres:postgres@postgres:5432/ralph_stock
      PYTHONPATH: /app:/app/services/api_gateway
    command: >
      sh -c "
      echo 'ðŸ”§ Initializing database...' &&
      python scripts/init_db.py &&
      echo 'âœ… Database initialization complete!'
      "
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - ralph-network
